<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Pixi Animaci칩n con Flechas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            margin: auto;
            background: #111;
        }
    </style>
</head>
<body>
    <!-- Cargar PIXI.js -->
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8.0.0/dist/pixi.min.js"></script>

    <!-- Cargar nuestras clases de animaci칩n -->
    <script src="animated-character.js"></script>

    <script type="module">
        /**
         * CONFIGURACI칍N Y INICIALIZACI칍N DEL JUEGO
         * =========================================
         * 
         * Este script inicializa la aplicaci칩n PIXI.js, carga todas las animaciones
         * y configura los controles del personaje.
         */

        // === CREAR LA APLICACI칍N PIXI.JS ===

        const app = new PIXI.Application();
        await app.init({ width: 512, height: 256, background: '#111' });
        document.body.appendChild(app.view);

        // === CONFIGURACI칍N DEL SPRITESHEET ===

        const frameW = 64;  // Ancho de cada frame individual
        const frameH = 64;  // Alto de cada frame individual
        const directions = ['up', 'left', 'down', 'right'];  // Orden de las direcciones

        // === INICIALIZAR SISTEMA DE ASSETS ===

        await PIXI.Assets.init();

        // === CONFIGURACI칍N DE ANIMACIONES ===

        // Cada animaci칩n tiene una velocidad de reproducci칩n personalizada
        const animationConfigs = {
            'run': { speed: 0.15 },         // Correr - velocidad media
            'walk': { speed: 0.1 },         // Caminar - m치s lento
            'idle': { speed: 0.08 },        // Inactivo - muy lento
            'combat_idle': { speed: 0.1 },  // Posici칩n de combate
            'jump': { speed: 0.2 },         // Saltar - r치pido
            'climb': { speed: 0.12 },       // Trepar - medio
            'sit': { speed: 0.05 },         // Sentarse - muy lento
            'hurt': { speed: 0.15 },        // Herido - medio
            'emote': { speed: 0.1 },        // Emoci칩n - medio
            'slash': { speed: 0.2 },        // Ataque con espada - r치pido
            'halfslash': { speed: 0.18 },   // Medio ataque - r치pido
            'backslash': { speed: 0.2 },    // Ataque reverso - r치pido
            'thrust': { speed: 0.2 },       // Estocada - r치pido
            'shoot': { speed: 0.15 },       // Disparar - medio
            'spellcast': { speed: 0.12 }    // Lanzar hechizo - medio-lento
        };

        // === CREAR EL PERSONAJE CON ANIMACIONES ===

        // const result = await AnimatedCharacter.CreateCharacterWithManyAnimations(
        //     animationConfigs,
        //     frameW,
        //     frameH,
        //     directions
        // );

        const result = await AnimatedCharacter.CreateCharacterFromMegaSpritesheet(
            'chica2.png',
            frameW,
            frameH,
            animationConfigs,
            directions
        );



        const character = result.character;
        const loadResults = result.loadResults;

        window.character = character; // Hacer accesible globalmente para debug

        // === MOSTRAR RESULTADOS DE CARGA ===
        console.log('游늵 Resultados de carga:', loadResults);

        // === POSICIONAR EL PERSONAJE ===

        character.x = app.screen.width / 2;   // Centrar horizontalmente
        character.y = app.screen.height / 2;  // Centrar verticalmente
        // character.setScale(0.5);            // Opcional: hacer m치s peque침o
        app.stage.addChild(character);

        // === CONFIGURAR CONTROLES ===

        window.addEventListener('keydown', (e) => {
            switch (e.key) {
                // === CONTROLES DE MOVIMIENTO ===
                case 'ArrowUp':
                    character.changeDirection('up');
                    break;
                case 'ArrowDown':
                    character.changeDirection('down');
                    break;
                case 'ArrowLeft':
                    character.changeDirection('left');
                    break;
                case 'ArrowRight':
                    character.changeDirection('right');
                    break;


            }
        });

        // === MOSTRAR AYUDA EN CONSOLA ===

        setTimeout(() => {
            console.log('=== PERSONAJE ANIMADO CARGADO ===');
            console.log('Available animations:', character.getAvailableAnimations());
            console.log('');
            console.log('=== CONTROLES ===');
            console.log('游끢 Movimiento: Flechas del teclado');
            console.log('');
            console.log('游꿠 Animaciones (n칰meros):');
            console.log('1: idle     2: walk     3: run      4: jump     5: combat_idle');
            console.log('6: slash    7: thrust   8: shoot    9: spellcast 0: sit');
            console.log('');
            console.log('游꿠 Animaciones (letras):');
            console.log('h: hurt     e: emote    c: climb');
            console.log('');
            console.log('游눠 Tip: Usa character.changeAnimation("nombre") en la consola para m치s control');
        }, 1000);


        function createUI() {
            for (let anim of Object.keys(AnimatedCharacter.bigSpriteAnimationConfigs)) {
                const button = document.createElement('button');
                button.textContent = anim;
                button.addEventListener('click', () => {
                    character.changeAnimation(anim);
                });
                document.body.appendChild(button);
            }
        }

        createUI()

    </script>
</body>
</html>